import{r as i,j as s,e as M,y as o}from"./app-OwheUbfH.js";import{c as j}from"./createLucideIcon-CjJzIEgK.js";import{X as R}from"./x-Mb0EpVdK.js";import{S as L}from"./save-BN3CQtQ0.js";const O=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],I=j("pen-line",O);const T=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],A=j("refresh-cw",T),X=({countries:r,baseCurrencyCode:m="USD",operatingCountryIso2:v,onRatesChange:n})=>{const d=r.find(e=>e.iso2===v),N=d&&parseFloat(d.exchange_rate_to_usd)||1,[c,l]=i.useState(()=>{const e={};return r.forEach(t=>{e[t.currency_code]=parseFloat(t.exchange_rate_to_usd||"1").toFixed(4)}),e}),[h,u]=i.useState({...c}),[x,p]=i.useState(!1),[b,f]=i.useState(!1),[g,y]=i.useState(!1);i.useEffect(()=>{const e={};r.forEach(t=>{e[t.currency_code]=parseFloat(t.exchange_rate_to_usd||"1").toFixed(4)}),l(e),u({...e})},[r]);const _=(e,t)=>{const a={...c,[e]:parseFloat(t).toFixed(4)};l(a),n&&n(a)},w=async()=>{if(r.length){f(!0);try{const e=await fetch(route("settings.currency.fetch"),{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({currencies:r.map(a=>a.currency_code)})}),t=await e.json();if(e.ok){const a=Object.fromEntries(Object.entries(t).map(([k,E])=>[k,parseFloat(E).toFixed(4)]));l(a),u({...a}),p(!1),o.success("Tasas actualizadas desde CurrencyFreaks"),n&&n(a)}else o.warning("Usando tasas manuales (API no disponible)")}catch(e){o.error("Error al conectar con el servidor"),console.error(e)}finally{f(!1)}}},S=()=>{l({...h}),p(!1),n&&n({...h})},F=e=>{e.preventDefault(),y(!0),M.put(route("settings.currencyrates.update"),{rates:c},{onFinish:()=>y(!1),onSuccess:()=>{o.success("Tasas de cambio guardadas"),u({...c})},onError:t=>{o.error("Error al guardar las tasas"),console.error(t)}})};return s.jsx("form",{onSubmit:F,className:"space-y-8",children:s.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl shadow-xl p-6 border border-white/20",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Tasas de Cambio"}),d?s.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["1 ",m," = ",N.toFixed(2)," ",d.currency_symbol]}):s.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["1 ",m," = ? [Moneda Local]"]})]}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsxs("button",{type:"button",onClick:w,disabled:b,className:"inline-flex items-center px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:[s.jsx(A,{className:`h-4 w-4 mr-2 ${b?"animate-spin":""}`}),"Actualizar desde API"]}),x?s.jsxs("button",{type:"button",onClick:S,className:"inline-flex items-center px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:[s.jsx(R,{className:"h-4 w-4 mr-2"}),"Cancelar edición"]}):s.jsxs("button",{type:"button",onClick:()=>p(!0),className:"inline-flex items-center px-3 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700",children:[s.jsx(I,{className:"h-4 w-4 mr-2"}),"Editar manualmente"]})]})]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 max-h-96 overflow-y-auto mt-6",children:r.map(e=>s.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[s.jsxs("div",{className:"text-sm font-medium text-gray-900 mb-1",children:[e.name," - ",e.currency_code," (",e.currency_symbol,")"]}),s.jsx("input",{type:"number",step:"0.0001",min:"0",value:c[e.currency_code]||"1.0000",onChange:t=>_(e.currency_code,t.target.value),readOnly:!x,className:`w-full px-2 py-1 text-sm border ${x?"border-gray-300 rounded focus:ring-2 focus:ring-emerald-500":"border-transparent bg-gray-100 rounded"}`}),s.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["1 ",m," = ",c[e.currency_code]||"1.0000"," ",e.currency_code]})]},`${e.iso2}-${e.currency_code}`))}),s.jsx("div",{className:"mt-8 pt-6 border-t border-gray-200",children:s.jsx("div",{className:"flex justify-end",children:s.jsxs("button",{type:"submit",disabled:g,className:"inline-flex items-center px-6 py-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 disabled:opacity-50",children:[s.jsx(L,{className:"h-5 w-5 mr-2"}),g?"Guardando...":"Guardar Configuración"]})})})]})})};export{X as default};
