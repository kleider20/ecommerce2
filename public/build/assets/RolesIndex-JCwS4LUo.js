import{j as e,L as E,e as _,r as h,R as G,y as b,H as I}from"./app-CU0P3dLZ.js";import{S as N}from"./shield-CqgJkrNT.js";import{P as U}from"./plus-Dug2Lo-k.js";import{S as K}from"./search-CUe7VZVA.js";import{B as Q,C as V}from"./crown-Da5DEL2d.js";import{U as W}from"./user-amanYjy-.js";import{B as X}from"./building-2-DnE3jmyH.js";import{P as J}from"./package-f3gHv5FB.js";import{G as Y}from"./globe-DZGUGtO-.js";import{K as L}from"./key-DaKh0RjK.js";import{U as k}from"./users-DZy9H-pM.js";import{P as Z}from"./pen-line-BNkY6O6p.js";import{T as ee}from"./trash-2-S0id-N7V.js";import{A as se}from"./arrow-left-DAITWovo.js";import{c as M}from"./createLucideIcon-CiwuWYqI.js";import{L as S}from"./lock-BdxXzi6d.js";import{C as re}from"./circle-check-big-C8xSsEib.js";import te from"./SuperAdminLayout-BQgZV6B7.js";import"./house-DlkN7RbE.js";import"./x-eJwtNvUz.js";import"./trending-up-zd-YtkJU.js";import"./credit-card-DOQqSUsI.js";import"./bell-CpvfukOz.js";const ae=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],T=M("circle-x",ae);const ie=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],oe=M("user-plus",ie),le=({canCreateRoles:s})=>e.jsx("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-200",children:e.jsx("div",{className:"px-6 py-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-xl flex items-center justify-center shadow-md",children:e.jsx(N,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900 tracking-tight",children:"Gestión de Roles y Permisos"}),e.jsx("p",{className:"text-sm text-gray-500 mt-0.5",children:"Administra roles, permisos y configuraciones de acceso del sistema"})]})]}),s&&e.jsxs(E,{href:route("roles.create"),className:"inline-flex items-center px-5 py-2.5 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-medium rounded-xl shadow-md hover:shadow-lg transition-all duration-200 transform hover:-translate-y-0.5 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Nuevo Rol"]})]})})}),ne=({searchTerm:s,onSearchChange:d,filterRole:o,onFilterChange:l,roles:u})=>e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(K,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Buscar roles por nombre o descripción...",value:s,onChange:a=>d(a.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("select",{value:o,onChange:a=>l(a.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"all",children:"Todos los roles"}),u.map(a=>e.jsx("option",{value:a.name,children:a.display_name},a.id))]})})]})}),ce={Shield:N,Users:k,Key:L,Globe:Y,Package:J,Building2:X,User:W,Crown:V,Bike:Q},de=({role:s,isSelected:d,onClick:o,canModifyRole:l,isSuperAdmin:u,onToggleRegister:a,onDeleteRole:m})=>{const x=ce[s.icon]||N,w=l(s);return e.jsxs("div",{className:`p-6 rounded-xl border-2 cursor-pointer transition-all duration-200 hover:shadow-lg ${d?"border-blue-500 bg-blue-50 ring-2 ring-blue-200":"border-gray-200 hover:border-gray-300"}`,onClick:o,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${s.color}`,children:e.jsx(x,{className:"w-6 h-6"})}),e.jsx("h3",{className:"font-semibold text-gray-900 text-lg",children:s.display_name})]}),u&&e.jsx("button",{onClick:n=>{n.stopPropagation(),a(s.id)},className:`relative inline-flex h-5 w-9 items-center rounded-full transition-colors focus:outline-none ${s.show_in_register?"bg-green-500":"bg-gray-300"}`,"aria-pressed":s.show_in_register,title:s.show_in_register?"Desactivar en registro":"Activar en registro",children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${s.show_in_register?"translate-x-4":"translate-x-0.5"}`})})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:s.description}),e.jsx("span",{className:`inline-flex px-2 py-0.5 rounded-full text-xs font-medium ${s.show_in_register?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:s.show_in_register?"Activo en registro":"Inactivo en registro"}),e.jsxs("div",{className:"mt-4 flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-4 text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(k,{className:"w-4 h-4"}),s.users_count||0]}),e.jsxs("span",{className:"flex items.center gap-1",children:[e.jsx(L,{className:"w-4 h-4"}),s.permissions_count||0]})]}),e.jsx("div",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.color}`,children:s.name})]}),w&&e.jsxs("div",{className:"flex justify-end gap-2 pt-3 border-t border-gray-100",children:[e.jsx("button",{className:"flex items-center justify-center w-9 h-9 text-gray-600 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 hover:text-blue-700 transition-all shadow-sm hover:shadow-md",onClick:n=>{n.stopPropagation(),_.visit(route("roles.edit",s.id))},"aria-label":`Editar ${s.display_name}`,children:e.jsx(Z,{className:"w-4 h-4"})}),e.jsx("button",{className:"flex items-center justify-center w-9 h-9 text-gray-600 bg-white border border-gray-300 rounded-lg hover:bg-red-50 hover:text-red-700 transition-all shadow-sm hover:shadow-md",onClick:n=>{n.stopPropagation(),m(s.id)},"aria-label":`Eliminar ${s.display_name}`,children:e.jsx(ee,{className:"w-4 h-4"})})]})]})},B=({isOpen:s,onClose:d,onConfirm:o,title:l="Confirmar acción",message:u="¿Está seguro de realizar esta acción? Esta operación no se puede deshacer.",confirmText:a="Sí, eliminar",cancelText:m="Cancelar"})=>s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full p-6 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:l})]}),e.jsx("p",{className:"text-gray-600 mb-6",children:u}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:d,className:"flex-1 px-4 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 font-medium transition-colors",children:m}),e.jsx("button",{onClick:o,className:"flex-1 px-4 py-2.5 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg shadow-sm hover:shadow transition-colors",children:a})]})]})}):null,$={Shield:N,Users:k},me=({selectedRole:s,permissions:d,canModifyPermissions:o,onBack:l,authUser:u})=>{const[a,m]=h.useState(!1),[x,w]=h.useState(null),n=t=>d.some(i=>i.id===t&&i.users_count>0),p=(t=>d.filter(i=>i.roles&&i.roles.some(c=>c.id===t)))(s.id),f=d.filter(t=>!p.find(i=>i.id===t.id)),v=t=>{w(t),m(!0)},R=()=>{x&&_.post(route("roles.permissions.detach",{role:s.id,permission:x.id}),{},{onSuccess:()=>{m(!1),b.success("Permiso removido exitosamente",{position:"top-center",autoClose:3e3})},onError:t=>{b.error(t?.error||"Error al quitar el permiso"),m(!1)}})},C=t=>{_.post(route("roles.permissions.attach",{role:s.id,permission:t.id}),{},{onSuccess:()=>{b.success("Permiso asignado exitosamente",{position:"top-center",autoClose:3e3})},onError:i=>{b.error(i?.error||"Error al asignar el permiso")}})};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:l,className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Volver a roles",children:e.jsx(se,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${s.color} shadow-sm`,children:$[s.icon]?G.createElement($[s.icon],{className:"w-6 h-6"}):e.jsx(N,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:s.display_name}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:s.description})]})]})]}),o&&e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(E,{href:"/permissions/create",className:"inline-flex items-center px-4 py-2.5 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-medium rounded-lg shadow-md hover:shadow-lg transition-all duration-200",children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Asignar Usuarios"]}),e.jsx(E,{href:route("roles.permissions.create"),className:"inline-flex items-center px-4 py-2.5 bg-white border border-gray-300 text-gray-700 hover:bg-gray-50 font-medium rounded-lg transition-colors",children:"+ Agregar Permiso"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm",children:[e.jsx("div",{className:"px-6 py-5 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Permisos Asignados"}),e.jsx("span",{className:"inline-flex items-center justify-center w-6 h-6 bg-blue-100 text-blue-800 text-xs font-bold rounded-full",children:p.length})]})}),e.jsx("div",{className:"p-6 space-y-4 max-h-96 overflow-y-auto",children:p.length>0?p.map(t=>{const i=n(t.id),c=t.is_critical,j=o&&!i&&!c;return e.jsxs("div",{className:"flex items-start justify-between p-4 bg-gray-50 rounded-xl border border-gray-100",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:t.display_name}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:t.description}),(i||c)&&e.jsxs("div",{className:"flex flex-wrap gap-2 mt-3",children:[i&&e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[e.jsx(k,{className:"w-3 h-3 mr-1"})," Asignado"]}),c&&e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[e.jsx(S,{className:"w-3 h-3 mr-1"})," Crítico"]})]})]}),j?e.jsx("button",{onClick:()=>v(t),className:"flex items-center justify-center w-9 h-9 text-red-600 hover:text-red-800 hover:bg-red-50 rounded-lg transition-colors","aria-label":"Quitar permiso",children:e.jsx(T,{className:"w-5 h-5"})}):e.jsx("div",{className:"flex items-center justify-center w-9 h-9 text-gray-400",children:e.jsx(S,{className:"w-5 h-5"})})]},t.id)}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(L,{className:"w-6 h-6 text-gray-400"})}),e.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:"Sin permisos asignados"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Aún no se han asignado permisos a este rol."})]})})]}),e.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm",children:[e.jsx("div",{className:"px-6 py-5 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Permisos Disponibles"}),e.jsx("span",{className:"inline-flex items-center justify-center w-6 h-6 bg-gray-100 text-gray-800 text-xs font-bold rounded-full",children:f.length})]})}),e.jsx("div",{className:"p-6 space-y-4 max-h-96 overflow-y-auto",children:f.length>0?f.map(t=>{const i=n(t.id),c=t.is_critical,j=o&&!c;return e.jsxs("div",{className:`flex items-start justify-between p-4 rounded-xl border ${j?"border-gray-200 hover:border-blue-300 bg-white":"border-gray-200 bg-gray-50 cursor-not-allowed"} transition-colors`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:t.display_name}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:t.description}),(i||c)&&e.jsxs("div",{className:"flex flex-wrap gap-2 mt-3",children:[i&&e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[e.jsx(k,{className:"w-3 h-3 mr-1"})," Asignado"]}),c&&e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[e.jsx(S,{className:"w-3 h-3 mr-1"})," Crítico"]})]})]}),j?e.jsx("button",{onClick:()=>C(t),className:"flex items-center justify-center w-9 h-9 text-green-600 hover:text-green-800 hover:bg-green-50 rounded-lg transition-colors","aria-label":"Asignar permiso",children:e.jsx(re,{className:"w-5 h-5"})}):e.jsx("div",{className:"flex items-center justify-center w-9 h-9 text-gray-400",children:c?e.jsx(S,{className:"w-5 h-5"}):e.jsx(T,{className:"w-5 h-5"})})]},t.id)}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(N,{className:"w-6 h-6 text-gray-400"})}),e.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:"Todos los permisos asignados"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No hay permisos disponibles para asignar."})]})})]})]}),e.jsx(B,{isOpen:a,onClose:()=>m(!1),onConfirm:R,title:"Quitar permiso",message:`¿Está seguro de quitar el permiso "${x?.display_name}" de este rol?`,confirmText:"Sí, quitar",cancelText:"Cancelar"})]})},$e=({roles:s,permissions:d,authUser:o})=>{const[l,u]=h.useState(null),[a,m]=h.useState(""),[x,w]=h.useState("all"),[n,P]=h.useState(s),[p,f]=h.useState(!1),[v,R]=h.useState(null),C=o.roles.some(r=>r.name==="super_admin"),t=o.roles.some(r=>r.name==="admin"),i=l&&o.roles.some(r=>r.id===l.id),c=l&&l.name==="super_admin",j=C,H=r=>!(r.name==="super_admin"&&C||o.roles.some(g=>g.id===r.id)||r.name==="super_admin"&&t),O=!c&&!i,D=h.useMemo(()=>n.filter(r=>!(t&&r.name==="super_admin")),[n,t]),A=h.useMemo(()=>D.filter(r=>{const g=r.display_name.toLowerCase().includes(a.toLowerCase())||r.description&&r.description.toLowerCase().includes(a.toLowerCase()),y=x==="all"||r.name===x;return g&&y}),[D,a,x]),q=r=>{_.patch(route("roles.toggle-register",r),{},{preserveScroll:!0,onSuccess:()=>{const g=n.map(y=>y.id===r?{...y,show_in_register:!y.show_in_register}:y);P(g)},onError:g=>{console.error("Error al actualizar:",g)}})},z=r=>{R(r),f(!0)},F=()=>{_.delete(route("roles.destroy",v),{onSuccess:()=>{const r=n.filter(g=>g.id!==v);P(r),f(!1),b.success("¡Rol eliminado exitosamente!",{position:"top-center",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0})},onError:r=>{b.error(r?.error||"Error al eliminar el rol",{position:"top-center",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0})}})};return e.jsxs(te,{children:[e.jsx(I,{title:"Gestión de Roles y Permisos"}),e.jsxs("div",{className:"mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 px-6 py-5 border-b border-gray-200",children:e.jsx(le,{canCreateRoles:j})}),e.jsx("div",{className:"p-6 md:p-8",children:l?e.jsx(me,{selectedRole:l,permissions:d,canModifyPermissions:O,onBack:()=>u(null),authUser:o}):e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"bg-gray-50 rounded-xl border border-gray-200 p-5",children:e.jsx(ne,{searchTerm:a,onSearchChange:m,filterRole:x,onFilterChange:w,roles:A})}),A.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:A.map(r=>e.jsx(de,{role:r,isSelected:l?.id===r.id,onClick:()=>u(r),canModifyRole:H,isSuperAdmin:C,onToggleRegister:q,onDeleteRole:z},r.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No se encontraron roles"}),e.jsx("p",{className:"text-gray-500",children:"Ajusta los filtros o crea un nuevo rol."})]})]})})]}),e.jsx(B,{isOpen:p,onClose:()=>f(!1),onConfirm:F,title:"Eliminar rol",message:`¿Está seguro de eliminar el rol "${n.find(r=>r.id===v)?.display_name}"? Esta acción no se puede deshacer y los usuarios asignados quedarán sin rol.`,confirmText:"Sí, eliminar",cancelText:"Cancelar"})]})]})};export{$e as default};
