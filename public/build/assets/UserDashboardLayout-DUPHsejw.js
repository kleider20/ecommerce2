import{d as j,r as d,y as S,j as e,e as b,u as k,L as C}from"./app-CU0P3dLZ.js";import{B as E}from"./bell-CpvfukOz.js";import{c as v}from"./createLucideIcon-CiwuWYqI.js";import{H as I}from"./house-DlkN7RbE.js";import{S as A}from"./settings-Bz4WI6Zd.js";import{A as R}from"./award-1yvRhLOO.js";const _=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],U=v("log-out",_);const $=[["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}],["path",{d:"M3.103 6.034h17.794",key:"awc11p"}],["path",{d:"M3.4 5.467a2 2 0 0 0-.4 1.2V20a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6.667a2 2 0 0 0-.4-1.2l-2-2.667A2 2 0 0 0 17 2H7a2 2 0 0 0-1.6.8z",key:"o988cm"}]],M=v("shopping-bag",$),B=()=>{const{props:r}=j(),{auth:i,unreadGlobalNotificationsCount:a=0,globalNotifications:o=[]}=r;if(!i?.user)return null;const[n,m]=d.useState(!1),[c,x]=d.useState([]),[h,p]=d.useState(a),g=d.useRef(!1),l=d.useRef(null);d.useEffect(()=>{if(!g.current&&o){const s=Array.isArray(o)?o:o?.data||[];x(s),p(s.filter(t=>!t.read).length),g.current=!0}},[o]);const f=d.useCallback(s=>{if(!s?.id)return;const t=`toast_${s.id}`;sessionStorage.getItem(t)||(sessionStorage.setItem(t,"1"),setTimeout(()=>sessionStorage.removeItem(t),1e4),S.info(e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.message}),e.jsx("div",{className:"text-xs opacity-80",children:s.time})]}),{autoClose:8e3,onClick:()=>b.visit(`/notifications/${s.id}`),style:{cursor:"pointer"}}))},[b]);d.useEffect(()=>{const s=i.user.id;if(l.current)try{l.current.leave(`notifications.${s}`)}catch(t){console.warn("Error al limpiar instancia anterior:",t)}if(window.Echo)try{const t=window.Echo.private(`notifications.${s}`).listen("NotificationCreated",u=>{x(N=>[u,...N]),p(N=>N+1),f(u)});l.current=t}catch(t){console.error("Error al conectar con Pusher:",t)}return()=>{if(l.current&&window.Echo)try{window.Echo.leave(`notifications.${s}`),l.current=null}catch(t){console.warn("Error al limpiar Echo:",t)}}},[i.user.id,f]),d.useEffect(()=>{if(c.length>0&&g.current){const s=c.filter(t=>!t.read);if(s.length>0){const t=setTimeout(()=>{s.forEach(u=>f(u))},300);return()=>clearTimeout(t)}}},[c,f]);const y=d.useCallback(async s=>{if(s?.id)try{await fetch(`/notifications/${s.id}/read`,{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}),x(t=>t.map(u=>u.id===s.id?{...u,read:!0}:u)),p(t=>Math.max(0,t-1)),b.visit(`/notifications/${s.id}`)}catch(t){console.error("Error al procesar notificaci칩n:",t)}},[b]);d.useEffect(()=>{const s=t=>{t.target.closest(".notifications-dropdown")||m(!1)};return document.addEventListener("click",s),()=>document.removeEventListener("click",s)},[]);const w=s=>{const t={order:"bg-green-500",promotion:"bg-purple-500",default:"bg-blue-500"},u=t[s]||t.default;return e.jsx("div",{className:`w-4 h-4 ${u} rounded-full`})};return e.jsxs("div",{className:"relative notifications-dropdown",children:[e.jsxs("button",{onClick:()=>m(!n),className:"p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg relative",children:[e.jsx(E,{className:"w-5 h-5"}),h>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center min-w-[20px]",children:h>99?"99+":h})]}),n&&e.jsxs("div",{className:"absolute right-0 mt-2 w-80 bg-white rounded-xl shadow-lg border border-gray-200 z-50",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsx("h3",{className:"font-semibold text-gray-900",children:"Notificaciones"})}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:c.length?c.slice(0,3).map(s=>e.jsx("div",{className:`p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer ${s.read?"":"bg-blue-50"}`,onClick:()=>y(s),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",children:w(s.type)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-900",children:s.message}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s.time})]})]})},s.id)):e.jsx("div",{className:"p-4 text-center text-gray-500",children:"No tienes notificaciones nuevas"})}),e.jsx("div",{className:"p-3 border-t border-gray-200",children:e.jsx("button",{onClick:()=>b.visit("/notifications"),className:"w-full text-center text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Ver todas las notificaciones"})})]})]})},L=({user:r})=>{const[i,a]=d.useState(!1),{post:o}=k(),n=r.profile?.avatar_url||"ui-avatars.com{encodeURIComponent(user.name)}&background=3b82f6&color=fff",[m,c]=d.useState(n);d.useEffect(()=>{r.profile?.avatar_url&&c(r.profile.avatar_url)},[r.profile?.avatar_url]);const x=h=>{h.preventDefault(),o("/logout")};return e.jsx("header",{className:"bg-white border-b border-gray-200 sticky top-0 z-40",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-gradient-to-r from-blue-600 to-indigo-600 flex items-center justify-center",children:e.jsx(M,{className:"w-5 h-5 text-white"})}),e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Mi Cuenta"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(B,{}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>a(!i),className:"flex items-center gap-3 focus:outline-none",children:[e.jsx("img",{src:m,alt:r.name,className:"w-9 h-9 rounded-full border-2 border-indigo-100 object-cover shadow-sm",onError:()=>{c("ui-avatars.com{encodeURIComponent(user.name)}&background=3b82f6&color=fff")}}),e.jsx("span",{className:"hidden sm:block text-sm font-medium text-gray-900",children:r.name})]}),i&&e.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-50 py-1",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:r.name}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:r.email})]}),e.jsxs("button",{onClick:x,className:"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4"}),"Cerrar sesi칩n"]})]})]})]})]})})},O=[{id:"dashboard",label:"Dashboard",icon:I,routeName:"dashboard",permission:null,roles:["all"]},{id:"user_settings",label:"Configuraci칩n",icon:A,routeName:"user.settings",permission:"",roles:["super_admin","user","proveedor","vendedor"]}],D=(r=[])=>{const i=Array.isArray(r)?r:[];return O.map(a=>{if(a.submenu){const o=a.submenu.filter(n=>n.roles.includes("all")||n.roles.some(m=>i.includes(m)));return o.length>0?{...a,submenu:o}:{...a,submenu:null}}return a}).filter(a=>a.roles.includes("all")||a.roles.some(o=>i.includes(o)))},H=(r,i=[])=>{const a=Array.isArray(i)?i:[];return D(r).map(n=>{if(n.submenu){const m=n.submenu.filter(c=>!c.permission||a.includes(c.permission));return m.length>0?{...n,submenu:m}:{...n,submenu:null}}return n}).filter(n=>!n.permission||a.includes(n.permission))},T=({user:r})=>{const{props:i}=j(),a=i.auth?.user;if(!a)return null;const o=a.permissions||[],n=a.roles||[],c=H(n,o).map(l=>({...l,route:route(l.routeName)})),[x,h]=d.useState(new Set),p=c.filter(l=>l.permission?o.includes(l.permission):!0),g=l=>{const f=l.icon,y=route().current(l.routeName);return e.jsxs(C,{href:l.route,className:`w-full flex items-center gap-3 px-3 py-2 rounded-lg text-left transition-colors ${y?"bg-blue-50 text-blue-700 font-medium":"text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(f,{className:"w-4 h-4"}),l.label]},l.id)};return e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("img",{src:r.avatar||"https://placehold.co/80x80/3b82f6/ffffff?text=U",alt:r.name,className:"w-12 h-12 rounded-full border-2 border-gray-300"}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-gray-900",children:r.name}),e.jsx("p",{className:"text-sm text-gray-600",children:r.email})]})]}),e.jsx("div",{className:"space-y-1",children:p.map(g)}),e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:["Miembro ",r.membership||"B치sico"]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Desde ",r.memberSince||"2024"]})]}),e.jsx(R,{className:"w-6 h-6 text-yellow-500"})," "]})})]})},q=({children:r,user:i,activeTab:a,onTabChange:o,notifications:n=[],onMarkNotificationAsRead:m,unreadNotifications:c=0,userPermissions:x=[]})=>e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(L,{user:i,notifications:n,unreadNotifications:c,onMarkNotificationAsRead:m}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsx(T,{user:i,activeTab:a,onTabChange:o,userPermissions:x})}),e.jsx("div",{className:"lg:col-span-3",children:r})]})})]});export{q as default};
