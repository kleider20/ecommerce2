import{b as v,r as d,y as S,j as e,a as b,u as k,L as E}from"./app-_a53eJXV.js";import{B as I}from"./bell-5ygFa6zN.js";import{c as w}from"./createLucideIcon-mfdPizJi.js";import{H as y}from"./house-nF5WhPbl.js";import{S as $}from"./settings-zIIRNtMQ.js";import{A as U}from"./award-CdVpQ_1T.js";const A=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],R=w("log-out",A);const M=[["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}],["path",{d:"M3.103 6.034h17.794",key:"awc11p"}],["path",{d:"M3.4 5.467a2 2 0 0 0-.4 1.2V20a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6.667a2 2 0 0 0-.4-1.2l-2-2.667A2 2 0 0 0 17 2H7a2 2 0 0 0-1.6.8z",key:"o988cm"}]],_=w("shopping-bag",M),B=()=>{const{props:t}=v(),{auth:l,unreadGlobalNotificationsCount:a=0,globalNotifications:i=[]}=t;if(!l?.user)return null;const[n,m]=d.useState(!1),[c,h]=d.useState([]),[f,p]=d.useState(a),x=d.useRef(!1),o=d.useRef(null);d.useEffect(()=>{if(!x.current&&i){const s=Array.isArray(i)?i:i?.data||[];h(s),p(s.filter(r=>!r.read).length),x.current=!0}},[i]);const g=d.useCallback(s=>{if(!s?.id)return;const r=`toast_${s.id}`;sessionStorage.getItem(r)||(sessionStorage.setItem(r,"1"),setTimeout(()=>sessionStorage.removeItem(r),1e4),S.info(e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.message}),e.jsx("div",{className:"text-xs opacity-80",children:s.time})]}),{autoClose:8e3,onClick:()=>b.visit(`/notifications/${s.id}`),style:{cursor:"pointer"}}))},[b]);d.useEffect(()=>{const s=l.user.id;if(o.current)try{o.current.leave(`notifications.${s}`)}catch(r){console.warn("Error al limpiar instancia anterior:",r)}if(window.Echo)try{const r=window.Echo.private(`notifications.${s}`).listen("NotificationCreated",u=>{h(j=>[u,...j]),p(j=>j+1),g(u)});o.current=r}catch(r){console.error("Error al conectar con Pusher:",r)}return()=>{if(o.current&&window.Echo)try{window.Echo.leave(`notifications.${s}`),o.current=null}catch(r){console.warn("Error al limpiar Echo:",r)}}},[l.user.id,g]),d.useEffect(()=>{if(c.length>0&&x.current){const s=c.filter(r=>!r.read);if(s.length>0){const r=setTimeout(()=>{s.forEach(u=>g(u))},300);return()=>clearTimeout(r)}}},[c,g]);const N=d.useCallback(async s=>{if(s?.id)try{await fetch(`/notifications/${s.id}/read`,{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}),h(r=>r.map(u=>u.id===s.id?{...u,read:!0}:u)),p(r=>Math.max(0,r-1)),b.visit(`/notifications/${s.id}`)}catch(r){console.error("Error al procesar notificaci칩n:",r)}},[b]);d.useEffect(()=>{const s=r=>{r.target.closest(".notifications-dropdown")||m(!1)};return document.addEventListener("click",s),()=>document.removeEventListener("click",s)},[]);const C=s=>{const r={order:"bg-green-500",promotion:"bg-purple-500",default:"bg-blue-500"},u=r[s]||r.default;return e.jsx("div",{className:`w-4 h-4 ${u} rounded-full`})};return e.jsxs("div",{className:"relative notifications-dropdown",children:[e.jsxs("button",{onClick:()=>m(!n),className:"p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg relative",children:[e.jsx(I,{className:"w-5 h-5"}),f>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center min-w-[20px]",children:f>99?"99+":f})]}),n&&e.jsxs("div",{className:"absolute right-0 mt-2 w-80 bg-white rounded-xl shadow-lg border border-gray-200 z-50",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsx("h3",{className:"font-semibold text-gray-900",children:"Notificaciones"})}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:c.length?c.slice(0,3).map(s=>e.jsx("div",{className:`p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer ${s.read?"":"bg-blue-50"}`,onClick:()=>N(s),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",children:C(s.type)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-900",children:s.message}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s.time})]})]})},s.id)):e.jsx("div",{className:"p-4 text-center text-gray-500",children:"No tienes notificaciones nuevas"})}),e.jsx("div",{className:"p-3 border-t border-gray-200",children:e.jsx("button",{onClick:()=>b.visit("/notifications"),className:"w-full text-center text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Ver todas las notificaciones"})})]})]})},L=({user:t,size:l="w-10 h-10",shape:a="rounded-full",className:i="",showBorder:n=!0})=>{const[m,c]=d.useState(""),h=()=>{if(t.profile?.avatar_url)return t.profile.avatar_url;const x=(t.name||"U").split(" ").map(o=>o[0]).join("").substring(0,2).toUpperCase();return`https://ui-avatars.com/api/?name=${encodeURIComponent(x)}&background=3b82f6&color=fff`};d.useEffect(()=>{c(h())},[t.profile?.avatar_url,t.name]);const f=()=>{const x=(t.name||"U").split(" ").map(o=>o[0]).join("").substring(0,2).toUpperCase();c(`https://ui-avatars.com/api/?name=${encodeURIComponent(x)}&background=3b82f6&color=fff`)};return e.jsx("img",{src:m,alt:t.name,className:`
        ${l}
        ${a}
        object-cover
        ${n?"border-2 border-indigo-100":""}
        shadow-sm
        ${i}
      `,onError:f})},O=({user:t})=>{const[l,a]=d.useState(!1),{post:i}=k(),n=m=>{m.preventDefault(),i("/logout")};return e.jsx("header",{className:"bg-white border-b border-gray-200 sticky top-0 z-40",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-gradient-to-r from-blue-600 to-indigo-600 flex items-center justify-center",children:e.jsx(_,{className:"w-5 h-5 text-white"})}),e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Mi Cuenta"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(B,{}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>a(!l),className:"flex items-center gap-3 focus:outline-none",children:[e.jsx(L,{user:t,size:"w-12 h-12",shape:"rounded-full"})," ",e.jsx("span",{className:"hidden sm:block text-sm font-medium text-gray-900",children:t.name})]}),l&&e.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-50 py-1",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:t.name}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:t.email})]}),e.jsxs("button",{onClick:n,className:"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4"}),"Cerrar sesi칩n"]})]})]})]})]})})},D=[{id:"home",label:"Inicio",icon:y,routeName:"/",permission:null,roles:["all"]},{id:"dashboard",label:"Dashboard",icon:y,routeName:"dashboard",permission:null,roles:["all"]},{id:"profile",label:"Mi Perfil",icon:y,routeName:"profile",permission:null,roles:["all"]},{id:"user_settings",label:"Configuraci칩n",icon:$,routeName:"user.settings",permission:"",roles:["super_admin","user","proveedor","vendedor"]}],z=(t=[])=>{const l=Array.isArray(t)?t:[];return D.map(a=>{if(a.submenu){const i=a.submenu.filter(n=>n.roles.includes("all")||n.roles.some(m=>l.includes(m)));return i.length>0?{...a,submenu:i}:{...a,submenu:null}}return a}).filter(a=>a.roles.includes("all")||a.roles.some(i=>l.includes(i)))},H=(t,l=[])=>{const a=Array.isArray(l)?l:[];return z(t).map(n=>{if(n.submenu){const m=n.submenu.filter(c=>!c.permission||a.includes(c.permission));return m.length>0?{...n,submenu:m}:{...n,submenu:null}}return n}).filter(n=>!n.permission||a.includes(n.permission))},P=({user:t})=>{const{props:l}=v(),a=l.auth?.user;if(!a)return null;const i=a.permissions||[],n=a.roles||[],c=H(n,i).map(o=>({...o,route:route(o.routeName)})),[h,f]=d.useState(new Set),p=c.filter(o=>o.permission?i.includes(o.permission):!0),x=o=>{const g=o.icon,N=route().current(o.routeName);return e.jsxs(E,{href:o.route,className:`w-full flex items-center gap-3 px-3 py-2 rounded-lg text-left transition-colors ${N?"bg-blue-50 text-blue-700 font-medium":"text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(g,{className:"w-4 h-4"}),o.label]},o.id)};return e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("img",{src:t.avatar||"https://placehold.co/80x80/3b82f6/ffffff?text=U",alt:t.name,className:"w-12 h-12 rounded-full border-2 border-gray-300"}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-gray-900",children:t.name}),e.jsx("p",{className:"text-sm text-gray-600",children:t.email})]})]}),e.jsx("div",{className:"space-y-1",children:p.map(x)}),e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:["Miembro ",t.membership||"B치sico"]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Desde ",t.memberSince||"2024"]})]}),e.jsx(U,{className:"w-6 h-6 text-yellow-500"})," "]})})]})},X=({children:t,user:l,activeTab:a,onTabChange:i,notifications:n=[],onMarkNotificationAsRead:m,unreadNotifications:c=0,userPermissions:h=[]})=>e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(O,{user:l,notifications:n,unreadNotifications:c,onMarkNotificationAsRead:m}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsx(P,{user:l,activeTab:a,onTabChange:i,userPermissions:h})}),e.jsx("div",{className:"lg:col-span-3",children:t})]})})]});export{X as default};
