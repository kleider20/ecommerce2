// // resources/js/utils/generate-layout-registry.js
// import { readdir, stat, readFile, writeFile } from 'fs/promises';
// import { join, dirname, relative } from 'path';
// import { fileURLToPath } from 'url';

// const __filename = fileURLToPath(import.meta.url);
// const __dirname = dirname(__filename);

// // âœ… CORRECCIÃ“N: Agregar 'js' a la ruta
// const LAYOUTS_DIR = join(__dirname, '..', '..', 'js', 'Layouts');
// const OUTPUT_FILE = join(__dirname, '..', '..', 'js', 'Layouts', 'layoutRegistry.js');

// async function scanLayouts(dir, basePath = '') {
//   const layouts = {};

//   try {
//     const files = await readdir(dir);

//     for (const file of files) {
//       const fullPath = join(dir, file);
//       const fileStat = await stat(fullPath);

//       if (fileStat.isDirectory()) {
//         Object.assign(
//           layouts,
//           await scanLayouts(fullPath, join(basePath, file))
//         );
//       } else if (file.endsWith('.jsx')) {
//         const name = join(basePath, file.replace('.jsx', ''));
//         const normalizedPath = name.replace(/\\/g, '/');
//         layouts[normalizedPath] = `./${normalizedPath}.jsx`;
//       }
//     }
//   } catch (error) {
//     if (error.code !== 'ENOENT') {
//       throw error;
//     }
//   }

//   return layouts;
// }

// async function generateRegistry() {
//   console.log('ðŸ” Escaneando layouts en:', LAYOUTS_DIR);

//   const layouts = await scanLayouts(LAYOUTS_DIR);

//   if (Object.keys(layouts).length === 0) {
//     console.warn('âš ï¸ No se encontraron layouts .jsx');
//     return;
//   }

//   const content = `// ðŸš€ Auto-generated by generate-layout-registry.js
// // âŒ DO NOT EDIT MANUALLY - Changes will be overwritten
// // âœ… Run: npm run generate:layouts

// export const layoutRegistry = {
// ${Object.entries(layouts)
//   .map(([key, value]) => `  '${key}': () => import('${value}'),`)
//   .join('\n')}
// };
// `;

//   await writeFile(OUTPUT_FILE, content);

//   console.log(`âœ… Generado: ${OUTPUT_FILE}`);
//   console.log(`ðŸ“Š Layouts encontrados: ${Object.keys(layouts).length}`);
//   console.log('\nðŸ“ Layouts detectados:');
//   Object.keys(layouts).forEach(layout => {
//     console.log(`   - ${layout}`);
//   });
// }

// // Ejecutar
// await generateRegistry();


// resources/js/utils/generate-layout-registry.js
import { readdir, stat, readFile, writeFile } from 'fs/promises';
import { join, dirname } from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const LAYOUTS_DIR = join(__dirname, '..', '..', 'js', 'Layouts');
const OUTPUT_FILE = join(__dirname, '..', '..', 'js', 'Layouts', 'layoutRegistry.js');

// âœ… Solo incluir archivos que terminen con 'Layout.jsx'
function isLayoutFile(filename) {
  return filename.endsWith('Layout.jsx');
}

async function scanLayouts(dir, basePath = '') {
  const layouts = {};

  try {
    const files = await readdir(dir);

    for (const file of files) {
      const fullPath = join(dir, file);
      const fileStat = await stat(fullPath);

      if (fileStat.isDirectory()) {
        // Recursivo para subcarpetas
        Object.assign(
          layouts,
          await scanLayouts(fullPath, join(basePath, file))
        );
      } else if (isLayoutFile(file)) {
        // âœ… Solo archivos que terminen con Layout.jsx
        const name = join(basePath, file.replace('.jsx', ''));
        const normalizedPath = name.replace(/\\/g, '/');
        layouts[normalizedPath] = `./${normalizedPath}.jsx`;
      }
    }
  } catch (error) {
    if (error.code !== 'ENOENT') {
      throw error;
    }
  }

  return layouts;
}

async function generateRegistry() {
  console.log('ðŸ” Escaneando layouts en:', LAYOUTS_DIR);

  const layouts = await scanLayouts(LAYOUTS_DIR);

  if (Object.keys(layouts).length === 0) {
    console.warn('âš ï¸ No se encontraron layouts terminados en Layout.jsx');
    // âœ… Crear layout mÃ­nimo de fallback
    const fallbackContent = `// ðŸš€ Auto-generated fallback
export const layoutRegistry = {
  'BaseLayout': () => import('./BaseLayout.jsx'),
};
`;
    await writeFile(OUTPUT_FILE, fallbackContent);
    console.log('âœ… Generado layout de fallback:', OUTPUT_FILE);
    return;
  }

  const content = `// ðŸš€ Auto-generated by generate-layout-registry.js
// âŒ DO NOT EDIT MANUALLY - Changes will be overwritten
// âœ… Run: npm run generate:layouts

export const layoutRegistry = {
${Object.entries(layouts)
  .map(([key, value]) => `  '${key}': () => import('${value}'),`)
  .join('\n')}
};
`;

  await writeFile(OUTPUT_FILE, content);

  console.log(`âœ… Generado: ${OUTPUT_FILE}`);
  console.log(`ðŸ“Š Layouts encontrados: ${Object.keys(layouts).length}`);
  console.log('\nðŸ“ Layouts detectados:');
  Object.keys(layouts).forEach(layout => {
    console.log(`   - ${layout}`);
  });
}

// Ejecutar
await generateRegistry();
